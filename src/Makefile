# make - Ubuntu debug
# make release - Ubuntu release
# make openwrt - OpenWrt release

TARGET = whsnbg
SOURCES = $(wildcard *.c)
HEADERS = $(wildcard *.h)
OBJECTS = $(SOURCES:.c=.o)
DEPS = $(HEADERS)

# Ubuntu
DEF = -DUBUNTU
INCLPATH = -I.
LIBPATH = -L. -L/usr/lib
LIBS =

# axTLS
LIBS += -laxtls
# OpenSSL
#LIBS += -lssl
# OpenSSL-static
#LIBS += -lcrypto -lz

# MySQL client
INCLPATH += -I/usr/include/mysql
LIBS += -lmysqlclient -lz

# Add pthread and math libs
LIBS += -lpthread -lm

# static link
#LIBS += -ldl -static


# Ubuntu debug
FLAGS = -g -O2

all: $(TARGET)

$(TARGET): $(OBJECTS) $(DEPS)
	$(CC) $(LDFLAGS) -o $(TARGET) $(OBJECTS) $(LIBPATH) $(LIBS)

$(OBJECTS): $(SOURCES)
	$(CC) $(FLAGS) $(CFLAGS) $(DEF) -c $(SOURCES) $(INCLPATH)


# Ubuntu release
.PHONY: release
release: FLAGS = -O2 -DNDEBUG
release: $(TARGET)

# OpenWrt
.PHONY: openwrt
openwrt: FLAGS = -O2
openwrt: INCLPATH = $(TARGET_INCLPATH)
openwrt: LIBPATH = $(TARGET_LIBPATH)
openwrt: LIBS = $(TARGET_LIBS)
openwrt: DEF = $(TARGET_DEFS)
openwrt: $(TARGET)

.PHONY: clean
clean:
	rm -f $(OBJECTS) $(TARGET)
